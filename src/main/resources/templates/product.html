<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8" />
    <title>ìƒí’ˆ ê´€ë¦¬</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link
            href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
            rel="stylesheet"
    />
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <style>
        body {
            background-color: #f6f9f8;
            font-family: 'Segoe UI', 'Malgun Gothic', sans-serif;
            color: #333;
        }

        h2 {
            font-weight: bold;
            color: #3c988f;
        }

        .nav-tabs .nav-link {
            font-weight: 600;
            color: #3c988f;
            border-radius: 10px 10px 0 0;
        }

        .nav-tabs .nav-link.active {
            background-color: #d4f1ed;
            border-color: #d4f1ed #d4f1ed transparent;
        }

        .section-card {
            background-color: #ffffff;
            border: none;
            border-radius: 1rem;
            box-shadow: 0 0 10px rgba(0, 0, 0, 0.04);
            padding: 2rem;
        }

        .section-card .card-header {
            background-color: transparent;
            border-bottom: none;
            font-size: 1.25rem;
            color: #3c988f;
            font-weight: bold;
        }

        .form-control {
            border-radius: 0.7rem;
        }

        .btn-mint {
            background-color: #3c988f;
            border: none;
            color: white;
            font-weight: bold;
            padding: 0.6rem 2rem;
            border-radius: 999px;
        }

        .btn-mint:hover {
            background-color: #33877f;
        }

        .table thead {
            background-color: #e5f7f5;
            color: #2d7069;
        }

        .table td,
        .table th {
            vertical-align: middle;
        }

        .muted {
            color: #aaa;
        }
    </style>
</head>
<body>
<div class="container my-5">
    <h2 class="mb-4">ğŸ§¸ ìƒí’ˆ ê´€ë¦¬ ì‹œìŠ¤í…œ</h2>

    <!-- ë„¤ë¹„ê²Œì´ì…˜ -->
    <ul class="nav nav-tabs mb-5">
        <li class="nav-item">
            <a class="nav-link active" href="/ui/product">ìƒí’ˆ</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/ui/time-sale">íƒ€ì„ì„¸ì¼ (V1/V2)</a>
        </li>
        <li class="nav-item">
            <a class="nav-link" href="/ui/async-time-sale">íƒ€ì„ì„¸ì¼ (ë¹„ë™ê¸°)</a>
        </li>
    </ul>

    <!-- ìƒí’ˆ ë“±ë¡ -->
    <div class="section-card mb-5">
        <div class="card-header">ğŸ“ ìƒˆ ìƒí’ˆ ë“±ë¡</div>
        <form id="createProductForm" class="mt-4">
            <div class="mb-3">
                <label for="name" class="form-label">ìƒí’ˆëª…</label>
                <input
                        type="text"
                        class="form-control"
                        id="name"
                        required
                        placeholder="ì˜ˆ: ë¬´ì„  ì´ì–´í°"
                />
            </div>
            <div class="mb-3">
                <label for="price" class="form-label">ê°€ê²© (â‚©)</label>
                <input
                        type="number"
                        class="form-control"
                        id="price"
                        required
                        placeholder="ì˜ˆ: 299000"
                />
            </div>
            <div class="mb-3">
                <label for="description" class="form-label">ìƒí’ˆ ì„¤ëª…</label>
                <textarea
                        class="form-control"
                        id="description"
                        rows="3"
                        required
                        placeholder="ì˜ˆ: ê³ ìŒì§ˆ ë¸”ë£¨íˆ¬ìŠ¤ ë¬´ì„  ì´ì–´í°"
                ></textarea>
            </div>
            <div class="text-end">
                <button id="submitBtn" type="submit" class="btn-mint">ë“±ë¡í•˜ê¸°</button>
            </div>
        </form>
    </div>

    <!-- ìƒí’ˆ ëª©ë¡ -->
    <div class="section-card">
        <div class="card-header">ğŸ“‹ ìƒí’ˆ ëª©ë¡</div>
        <div class="card-body px-0">
            <table class="table mb-0">
                <thead>
                <tr>
                    <th>ë²ˆí˜¸</th>
                    <th>ì´ë¦„</th>
                    <th>ê°€ê²©</th>
                    <th>ì„¤ëª…</th>
                    <th>ë“±ë¡ì¼</th>
                </tr>
                </thead>
                <tbody id="productList">
                <tr>
                    <td colspan="5" class="text-center py-4 muted">ìƒí’ˆì„ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        const $form = $('#createProductForm');
        const $submitBtn = $('#submitBtn');
        const $productList = $('#productList');

        $form.submit(function (e) {
            e.preventDefault();
            $submitBtn.prop('disabled', true).text('ë“±ë¡ ì¤‘...');

            const data = {
                name: $('#name').val(),
                price: parseInt($('#price').val()),
                description: $('#description').val(),
            };

            $.ajax({
                url: '/api/v1/products',
                type: 'POST',
                contentType: 'application/json',
                data: JSON.stringify(data),
                success: function () {
                    alert('ğŸ‰ ìƒí’ˆì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!');
                    $form[0].reset();
                    loadProducts();
                },
                error: function (xhr) {
                    alert('âš ï¸ ì˜¤ë¥˜: ' + xhr.responseText);
                },
                complete: function () {
                    $submitBtn.prop('disabled', false).text('ë“±ë¡í•˜ê¸°');
                },
            });
        });

        function loadProducts() {
            $.get('/api/v1/products', function (products) {
                $productList.empty();
                if (products.length === 0) {
                    $productList.append(`
              <tr>
                <td colspan="5" class="text-center py-4 muted">ë“±ë¡ëœ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.</td>
              </tr>
            `);
                    return;
                }

                products.forEach(function (product) {
                    const formattedDate = new Date(product.createdAt).toLocaleString();
                    $productList.append(`
              <tr>
                <td>${product.id}</td>
                <td>${product.name}</td>
                <td>â‚©${product.price.toLocaleString()}</td>
                <td>${product.description}</td>
                <td>${formattedDate}</td>
              </tr>
            `);
                });
            });
        }

        loadProducts();
    });
</script>
</body>
</html>